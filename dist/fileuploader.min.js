var FileUploaderView=function(a){this.controller=a,this.main_template="",this.img_template="",this.add_img_template="",this.loadTemplates()};FileUploaderView.prototype.init=function(){var a=this,b=this.controller.getInput();b.css("visibility","hidden"),b.attr("type","text"),b.after("<div class='imageuploader-container' ></div>"),this.render(),$(document).change(".imgup-add-input",function(b){a.addFiles(b.target.files)})},FileUploaderView.prototype.addFiles=function(a){var b=0;for(b=0;b<a.length;b++)this.addImage(a[b])},FileUploaderView.prototype.addImage=function(a){var b=this,c=new FileReader,d=a.name,e=a.size;c.onload=function(a){b.controller.addImage(d,e,a.target.result),b.render()},c.readAsDataURL(a)},FileUploaderView.prototype.loadTemplates=function(){this.main_template=$(".imgup-template").html(),this.img_template=$(".imgup-image-template").html(),this.add_img_template=$(".imgup-image-add-template").html()},FileUploaderView.prototype.render=function(){var a=this;setTimeout(function(){for(var b=$(a.main_template),c=a.controller.getImageList(),d=0;d<c.length;d++){var e=c[d],f=$(a.img_template);a.applyPercent(f,e.percentComplete),$(".imgup-image",f).attr("src",e.data),$("ul",b).append(f)}$("ul",b).append(a.add_img_template),$(".imageuploader-container").html(b)},10)},FileUploaderView.prototype.updateView=function(a,b){this.applyPercent($(".imgup>ul li:nth-child("+a+")"),b)},FileUploaderView.prototype.applyPercent=function(a,b){$(".imgup-progress",a).css("height",100-b+"px")},FileUploaderView.prototype.updateurl=function(){var a=this.controller.getImagesURL(),b=this.controller.getInput();b.val(a)};var LPImage=function(a){this.name=void 0===a.name?"":a.name,this.size=void 0===a.size?"":a.size,this.data=void 0===a.data?"":a.data,this.url="",this.onprogress=void 0===a.onprogress?$.noop():a.onprogress,this.onupdateurl=void 0===a.onupdateurl?$.noop():a.onupdateurl,this.uploadurl=void 0===a.uploadurl?"/":a.uploadurl,this.percentComplete=0};LPImage.prototype.upload=function(){var a=this,b={name:this.name,size:this.size,data:this.data};$.ajax({url:this.uploadurl,method:"POST",cache:!1,data:b,xhr:function(){var b=new window.XMLHttpRequest;return b.addEventListener("progress",function(b){b.lengthComputable&&(a.percentComplete=Math.round(b.loaded/b.total*100),a.onprogress(a.percentComplete))},!1),b}}).done(function(b){a.url=b,a.onupdateurl()})},function(a,b,c,d){var e="fileuploader";a.fn[e]=function(b){var c={uploadurl:"/"},d=a.extend({},c,b);return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new FileUploader(this,d))})}}(jQuery,window,document);var FileUploader=function(a,b){this.$obj=$(a),this.options=b,this.model=[],this.view=new FileUploaderView(this),this.view.init()};FileUploader.prototype.addImage=function(a,b,c){var d=this;if(this.isImage(a)){var e=new LPImage({name:a,size:b,data:c,uploadurl:this.options.uploadurl,onprogress:function(a){d.view.updateView(d.model.indexOf(e),a)},onupdateurl:function(){d.view.updateurl()}});return e.upload(),this.model.push(e),e}},FileUploader.prototype.isImage=function(a){return-1!=a.indexOf(".jpg")||-1!=a.indexOf(".png")?!0:!1},FileUploader.prototype.getImageList=function(){return this.model},FileUploader.prototype.getInput=function(){return this.$obj},FileUploader.prototype.getImagesURL=function(){for(var a=[],b=0;b<this.model.length;b++){var c=this.model[b];a.push(c.url)}return a};